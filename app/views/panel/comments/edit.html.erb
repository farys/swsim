<% content_for :head do -%>
  <%= javascript_include_tag 'jquery.rating.js' %>
  <%= stylesheet_link_tag 'jquery.rating' %>
  <script type="text/javascript">
    $(document).ready(function(){
      $(".star").rating();
    });
    var allowed_points = <%= (@allowed_points.nil?)? true : @allowed_points %>;

    function checkForm(form){
      var sum = 0;
      $(".star:checked").each(function(){
        sum += $(this).val();
      });

      if (allowed_points < sum){
        alert("Punkty przeznaczone na ocenę zostały przekroczone.");
        return false
      }
      else
        return true;
    };
  </script>
<% end -%>
<div class="prepend-1 append-1">
  <% form_for [:panel, @comment], :onsubmit => "return checkForm(this)" do |f| -%>

    <%= render "layouts/error_messages", :target => @comment %>
    <p>Proszę ocenić użytkownika <%= escape_user(@receiver) %> za <% if @comment.level?(:auction) %> aukcję <%= link_auction(@comment.auction) %><% else %> projekt <%= link_to @comment.project.name, project_info_path %><% end %>:</p>
    <p>Dozwolona ilość punktów do rozdania: <%= @allowed_points %></p>
    <% @values.each do |v| %>
      <%= render "layouts/error_messages", :target => v %>
      <%= fields_for "comment_value", v, :index => "#{v.keyword.id}" do |ff| %>
        <%= ff.hidden_field :keyword_id %>
        <div style="margin-bottom:5px"><%= v.keyword.name.force_encoding("utf-8") %>:</div>
        <% for i in 1..5 %>
          <%= ff.radio_button :rating, i, :class => "star inline", :title => i %>
        <% end %>
        <%= ff.text_field :extra %>
        <br />
      <% end %>
    <% end %>

    <br />
    <%= f.submit "Wystaw" %>
  <% end -%>
</div>
